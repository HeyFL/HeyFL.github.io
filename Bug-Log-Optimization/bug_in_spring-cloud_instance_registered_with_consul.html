<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Spring-Cloud服务在Consul中的多实例注册问题 - 神奇宝贝大师的技术博客</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="[原创]个人理解，请批判接受，有误请指正。转载请注明出处: https://heyfl.github.io/Bug-Log-Optimization/bug_in_spring-cloud_instance_registered_with_consul.html   背景  公司实现微服务化并原来使用的Dubbo+Zookeeper实现应用间的服务调用，考虑到Dubbo不在维护最近想要切换为Sp"><meta name="keywords" content="BUG,优化,Spring-Cloud,Consul"><meta property="og:type" content="article"><meta property="og:title" content="Spring-Cloud服务在Consul中的多实例注册问题"><meta property="og:url" content="https://heyfl.github.io/Bug-Log-Optimization/bug_in_spring-cloud_instance_registered_with_consul.html"><meta property="og:site_name" content="神奇宝贝大师的技术博客"><meta property="og:description" content="[原创]个人理解，请批判接受，有误请指正。转载请注明出处: https://heyfl.github.io/Bug-Log-Optimization/bug_in_spring-cloud_instance_registered_with_consul.html   背景  公司实现微服务化并原来使用的Dubbo+Zookeeper实现应用间的服务调用，考虑到Dubbo不在维护最近想要切换为Sp"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://heyfl.github.io/images/bug-log/spring-cloud-with-consul/服务名+端口.png"><meta property="og:image" content="https://heyfl.github.io/images/bug-log/spring-cloud-with-consul/服务名+随机数.png"><meta property="og:image" content="https://heyfl.github.io/images/bug-log/spring-cloud-with-consul/服务名+随机数.png"><meta property="og:image" content="https://heyfl.github.io/images/bug-log/spring-cloud-with-consul/服务名+IP+端口.png"><meta property="og:updated_time" content="2019-08-25T12:13:55.485Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring-Cloud服务在Consul中的多实例注册问题"><meta name="twitter:description" content="[原创]个人理解，请批判接受，有误请指正。转载请注明出处: https://heyfl.github.io/Bug-Log-Optimization/bug_in_spring-cloud_instance_registered_with_consul.html   背景  公司实现微服务化并原来使用的Dubbo+Zookeeper实现应用间的服务调用，考虑到Dubbo不在维护最近想要切换为Sp"><meta name="twitter:image" content="https://heyfl.github.io/images/bug-log/spring-cloud-with-consul/服务名+端口.png"><link rel="icon" href="/images/avatar.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><link rel="stylesheet" href="/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"> <a class="navbar-item navbar-logo" href="/"><img src="/images/avatar.png" alt="Spring-Cloud服务在Consul中的多实例注册问题" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"> <a class="navbar-item" href="/">主页</a> <a class="navbar-item" href="/archives">归档</a> <a class="navbar-item" href="/categories">分类</a> <a class="navbar-item" href="/tags">标签</a> <a class="navbar-item" href="/about/about.html">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" title="GitHub" href="https://github.com/HeyFL" rel="external nofollow noopener noreferrer"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container" style="max-width:80vw;width:80vw"><div class="columns"><div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card" style="border-style:solid;border-width:2px;border-color:#737373"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"> Spring-Cloud服务在Consul中的多实例注册问题</h1><div class="post-meta"><div class="level-left" style="width:100%;display:block;text-align:center"><span><i class="far fa-calendar-alt"></i> <span>发表于</span> <span>2018-10-02</span></span> <span class="post-meta-divider">|</span><span class="far fa-eye"></span> <span id="busuanzi_container_page_pv" class="level-item has-text-grey">被围观 <span id="busuanzi_value_page_pv" class="foot-count">无数</span> 次</span><br><span><span class="far fa-folder"></span> <span>分类于</span> <span class="is-size-6 has-text-grey has-mr-7">#</span> <a class="has-link-grey -link" href="/tags/BUG/">BUG</a>, <a class="has-link-grey -link" href="/tags/Consul/">Consul</a>, <a class="has-link-grey -link" href="/tags/Spring-Cloud/">Spring-Cloud</a>, <a class="has-link-grey -link" href="/tags/优化/">优化</a></span> <span class="post-meta-divider">|</span><i class="far fa-clock"></i> <span>6 分钟 读完 (大约 962 个字)</span></div></div><div class="content"><blockquote><p><font size="3" color="red">[原创]</font>个人理解，请批判接受，有误请指正。转载请注明出处: <a href="#">https://heyfl.github.io/Bug-Log-Optimization/bug_in_spring-cloud_instance_registered_with_consul.html</a></p></blockquote><hr><h2 id="背景"><strong>背景</strong></h2><blockquote><p>公司实现微服务化并原来使用的Dubbo+Zookeeper实现应用间的服务调用，考虑到Dubbo不在维护最近想要切换为Spring Cloud+Consul</p></blockquote><h2 id="环境"><strong>环境</strong></h2><ul><li>Spring Cloud: Edgware.SR3</li><li>Spring-boot: 1.5.13.RELEASE</li></ul><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.5.13.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;Edgware.SR3&lt;/version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure><p>根据网上流传的博客我们使用的配置为:</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.consul.discovery.instance-id=$&#123;spring.application.name&#125;-$&#123;server.port&#125;</span><br></pre></td></tr></table></figure><p>也就是【服务名】+【端口】的形式来标识Consul上的一个服务</p><hr><hr><h2 id="1-第一个问题"><strong>1. 第一个问题</strong></h2><h3 id="已注册上consul的服务被后启动的提供者覆盖-font-size-1-color-gray-采用-服务名-端口-的形式-font"><strong>已注册上Consul的服务被后启动的提供者覆盖</strong><font size="1" color="gray">(采用【服务名】+【端口】的形式)</font></h3><blockquote><p>在我们实际开发测试时候发现 无论服务起了多少个实例，最终展示到Consul都只有一个 :</p><div align="center"><img src="/images/bug-log/spring-cloud-with-consul/服务名+端口.png" alt="服务名+端口"></div> 怀疑是Consul以【服务名】+【端口】为实例的唯一标示，导致【后起来的服务】覆盖掉【原来已经注册到Consul上的服务】了 ，我们通过Feign调用时发现也确实是如此</blockquote><h3 id="1-1-kill-第一个问题"><strong>1.1. Kill 第一个问题</strong></h3><p>上<a href="https://cloud.spring.io/spring-cloud-static/Edgware.SR5/multi/multi_spring-cloud-consul-discovery.html#_making_the_consul_instance_id_unique" rel="external nofollow noopener noreferrer" target="_blank">Spring官方文档</a>轻松找到解决方案<font color="gray" size="1">(有问题还是官方文档好)</font></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.application.name&#125;:$&#123;vcap.application.instance_id:$&#123;spring.application.instance_id:$&#123;random.value&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>原理就是每次启动时注册的实例ID都为【服务名】+【随机数】：</p><div align="center"><img src="/images/bug-log/spring-cloud-with-consul/服务名+随机数.png" alt="服务名+随机数"></div> 通过这种形式，可以让每一个服务提供者（实例）都有效地注册到Consul上，并且Consul上的每一个Instance都能唯一映射到每一个提供者上<hr><hr><h2 id="2-第二-第三个问题"><strong>2. 第二、第三个问题</strong></h2><h3 id="2-1-服务器通过kill-9的重启脚本快速重启导致一个提供者在consul上注册了多次-consul注册的实例数-实际提供者数"><strong>2.1. 服务器通过Kill -9的重启脚本快速重启导致一个提供者在Consul上注册了多次(<code>Consul注册的实例</code>数&gt;<code>实际提供者</code>数)</strong></h3><blockquote><p><code>首先，我们要知道当系统执行</code>kill-9<code>命令的时候会立马强制关闭该进程，程序很可能正在处理请求中，同时也占用了一些的资源，本来需要做一些善后才能正常、安全的结束，但是你一个</code>kill-9<code>命令过来，程序就措手不及了。</code><br> 结合上述情况，实际上程序非正常重启，已经注册在consul上的服务没有被反注册，服务重新启动之后又重新的注册了一个新的服务上去了（而且重启后以前的服务在Consul心跳机制下海认为是可用的），一个服务就在Consul注册了多次了</p></blockquote><div align="center"><img src="/images/bug-log/spring-cloud-with-consul/服务名+随机数.png" alt="一个服务非法重启后在Consul注册了多个实例"></div><blockquote><p>这种情况可以修改重启脚本解决：<br> 通过Kill -15直接关闭提供者进程　　<a href="https://blog.csdn.net/qq_33468857/article/details/86672803" rel="external nofollow noopener noreferrer" target="_blank">可以参考这篇文章</a></p></blockquote><h3 id="2-2-服务名-随机数-的instanceid不能提供足够信息帮助我们快速定位问题"><strong>2.2. 【服务名】+【随机数】的InstanceID不能提供足够信息帮助我们快速定位问题</strong></h3><blockquote><p>上面的方案可以解决我们遇到的问题，但是有一点不足的是，Consul上看到的InstanceID都是【服务名】+【随机数】，随机数没有可读性可言，<br> 我们压根不能根据这个InstanceID一眼看出的它的服务提供者是谁。不便于我们排查问题</p></blockquote><h2 id="进一步优化"><strong>进一步优化</strong></h2><p>其实最好就是使用【服务名】+【机器IP】+【端口】的形式，这样既能通过唯一标示服务提供者解决 <code>Consul服务被覆盖的问题</code> 也能方便我们运维开发时快速知道当前服务的提供者列表，快速定位问题<br> <code>最终方案</code></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.consul.discovery.instance-id=$&#123;spring.application.name&#125;:$&#123;spring.cloud.client.ipAddress&#125;:$&#123;server.port&#125;</span><br></pre></td></tr></table></figure><div align="center"><img src="/images/bug-log/spring-cloud-with-consul/服务名+IP+端口.png" alt="服务名+IP+端口"></div><hr></div><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"> <span class="is-size-6 has-text-grey has-mr-7">#</span> <a class="has-link-grey -link" href="/tags/BUG/">BUG</a>, <a class="has-link-grey -link" href="/tags/Consul/">Consul</a>, <a class="has-link-grey -link" href="/tags/Spring-Cloud/">Spring-Cloud</a>, <a class="has-link-grey -link" href="/tags/优化/">优化</a></div></div></div></div><div style="text-align:center;color:#ccc;font-size:14px"> ------ 本文结束<i class="fa fa-paw"></i>感谢您的阅读 ------</div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/Distributed/How-To-Use-Distributed-Transaction.html"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">分布式事务解法</span></a></div><div class="level-end"> <a class="level level-item has-link-grey article-nav-next" href="/Make-A-Little-Progress-Every-Day/Make-A-Little-Progress-Every-Day.html"><span class="level-item">每天进步一点点</span><i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css"><script src="https://jjeejj.github.io/js/gitment.js"></script><script>var gitment=new Gitment({id:"Tue Oct 02 2018 17:56:10 GMT+0800",owner:"HeyFL",repo:"heyfl.github.io",oauth:{client_id:"5e29b8e11983abda2f99",client_secret:"1ebe24de503d7b6a285f9e4ac48fe6cad3f37cbe"}});gitment.render("comment-container")</script></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered"><div><figure class="image container is-128x128 has-mb-6"> <img class="is-rounded" src="/images/avatar.png" alt="Pokémon Master"></figure><p class="is-size-4 is-block"> Pokémon Master</p><p class="is-size-6 is-block"> Web Developer &amp; Designer</p><p class="is-size-6 is-flex is-flex-center has-text-grey"><i class="fas fa-map-marker-alt has-mr-7"></i> <span>ShenZhen, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading"> 文章</p><p class="title has-text-weight-normal"> 13</p></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading"> 分类</p><p class="title has-text-weight-normal"> 11</p></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading"> 标签</p><p class="title has-text-weight-normal"> 16</p></div></div></nav><div class="level"> <a class="level-item button is-link is-rounded" href="https://github.com/HeyFL" rel="external nofollow noopener noreferrer" target="_blank">关注我</a></div><div class="level is-mobile"><a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/HeyFL" rel="external nofollow noopener noreferrer"><i class="fab fa-github"></i></a><a class="level-item button is-white is-marginless" target="_blank" title="QQ(361389383)" href="tencent://message/?uin=361389383" rel="external nofollow noopener noreferrer"><i class="fab fa-qq"></i></a></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label"> 分类</h3><ul class="menu-list"><li> <a class="level is-marginless" href="/categories/Bug-Log-Optimization/"><span class="level-start"><span class="level-item">Bug-Log&Optimization</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/Distributed/"><span class="level-start"><span class="level-item">Distributed</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/JVM/"><span class="level-start"><span class="level-item">JVM</span></span> <span class="level-end"><span class="level-item tag">2</span></span></a></li><li> <a class="level is-marginless" href="/categories/Make-A-Little-Progress-Every-Day/"><span class="level-start"><span class="level-item">Make-A-Little-Progress-Every-Day</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/about/"><span class="level-start"><span class="level-item">about</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/bookmarks/"><span class="level-start"><span class="level-item">bookmarks</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/database/"><span class="level-start"><span class="level-item">database</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/categories/docker/"><span class="level-start"><span class="level-item">docker</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a><ul><li> <a class="level is-marginless" href="/categories/docker/redis/"><span class="level-start"><span class="level-item">redis</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li> <a class="level is-marginless" href="/categories/redis/"><span class="level-start"><span class="level-item">redis</span></span> <span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label"> 目录</h3><ul class="menu-list"><li> <a class="is-flex" href="#背景"><span class="has-mr-6">1</span> <span>背景</span></a></li><li> <a class="is-flex" href="#环境"><span class="has-mr-6">2</span> <span>环境</span></a></li><li> <a class="is-flex" href="#1-第一个问题"><span class="has-mr-6">3</span> <span>1. 第一个问题</span></a><ul class="menu-list"><li> <a class="is-flex" href="#已注册上consul的服务被后启动的提供者覆盖-font-size-1-color-gray-采用-服务名-端口-的形式-font"><span class="has-mr-6">3.1</span> <span>已注册上Consul的服务被后启动的提供者覆盖(采用【服务名】+【端口】的形式)</span></a></li><li> <a class="is-flex" href="#1-1-kill-第一个问题"><span class="has-mr-6">3.2</span> <span>1.1. Kill 第一个问题</span></a></li></ul></li><li> <a class="is-flex" href="#2-第二-第三个问题"><span class="has-mr-6">4</span> <span>2. 第二、第三个问题</span></a><ul class="menu-list"><li> <a class="is-flex" href="#2-1-服务器通过kill-9的重启脚本快速重启导致一个提供者在consul上注册了多次-consul注册的实例数-实际提供者数"><span class="has-mr-6">4.1</span> <span>2.1. 服务器通过Kill -9的重启脚本快速重启导致一个提供者在Consul上注册了多次(Consul注册的实例数&gt;实际提供者数)</span></a></li><li> <a class="is-flex" href="#2-2-服务名-随机数-的instanceid不能提供足够信息帮助我们快速定位问题"><span class="has-mr-6">4.2</span> <span>2.2. 【服务名】+【随机数】的InstanceID不能提供足够信息帮助我们快速定位问题</span></a></li></ul></li><li> <a class="is-flex" href="#进一步优化"><span class="has-mr-6">5</span> <span>进一步优化</span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"><div class="card widget"><div class="card-content"><h3 class="menu-label"> 最新文章</h3><article class="media"><a href="/database/innodb-record-level-locks.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="MySQL锁"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-26T10:59:26.000Z">2019-08-26</time></div> <a href="/database/innodb-record-level-locks.html" class="has-link-black-ter is-size-6">MySQL锁</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/database/">database</a></p></div></div></article><article class="media"><a href="/Spring/Spring-Circular-Dependencies.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="【Spring源码分析】循环依赖的处理"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-22T03:22:00.000Z">2019-05-22</time></div> <a href="/Spring/Spring-Circular-Dependencies.html" class="has-link-black-ter is-size-6">【Spring源码分析】循环依赖的处理</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/Spring/">Spring</a></p></div></div></article><article class="media"><a href="/JVM/JVM-Memory-Structure-Stack.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="java虚拟机栈的内存结构"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-19T13:22:00.000Z">2019-02-19</time></div> <a href="/JVM/JVM-Memory-Structure-Stack.html" class="has-link-black-ter is-size-6">java虚拟机栈的内存结构</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/JVM/">JVM</a></p></div></div></article><article class="media"><a href="/JVM/JVM-Memory-Structure-Menu.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="JVM内存结构-总纲"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-16T05:21:00.000Z">2019-02-16</time></div> <a href="/JVM/JVM-Memory-Structure-Menu.html" class="has-link-black-ter is-size-6">JVM内存结构-总纲</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/JVM/">JVM</a></p></div></div></article><article class="media"><a href="/redis/Redis-Partitioning.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis分片方案概要(Cluster or Codis)"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-15T07:21:00.000Z">2019-02-15</time></div> <a href="/redis/Redis-Partitioning.html" class="has-link-black-ter is-size-6">Redis分片方案概要(Cluster or Codis)</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/redis/">redis</a></p></div></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label"> 归档</h3><ul class="menu-list"><li> <a class="level is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span> <span class="level-end"><span class="level-item tag">5</span></span></a></li><li> <a class="level is-marginless" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/1970/12/"><span class="level-start"><span class="level-item">十二月 1970</span></span> <span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label"> 标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"> <a class="tags has-addons" href="/tags/BUG/"><span class="tag">BUG</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Consul/"><span class="tag">Consul</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/DATABASE/"><span class="tag">DATABASE</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/JVM内存结构/"><span class="tag">JVM内存结构</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/LOCK/"><span class="tag">LOCK</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/MYSQL/"><span class="tag">MYSQL</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Spring-Cloud/"><span class="tag">Spring-Cloud</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span> <span class="tag is-grey">3</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/redis集群/"><span class="tag">redis集群</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/事务/"><span class="tag">事务</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/优化/"><span class="tag">优化</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/分布式/"><span class="tag">分布式</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/每天进步一点点/"><span class="tag">每天进步一点点</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/源码分析/"><span class="tag">源码分析</span> <span class="tag is-grey">1</span></a></div></div></div></div></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right"><div class="card widget"><div class="card-content"><h3 class="menu-label"> 最新文章</h3><article class="media"><a href="/database/innodb-record-level-locks.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="MySQL锁"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-08-26T10:59:26.000Z">2019-08-26</time></div> <a href="/database/innodb-record-level-locks.html" class="has-link-black-ter is-size-6">MySQL锁</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/database/">database</a></p></div></div></article><article class="media"><a href="/Spring/Spring-Circular-Dependencies.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="【Spring源码分析】循环依赖的处理"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-05-22T03:22:00.000Z">2019-05-22</time></div> <a href="/Spring/Spring-Circular-Dependencies.html" class="has-link-black-ter is-size-6">【Spring源码分析】循环依赖的处理</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/Spring/">Spring</a></p></div></div></article><article class="media"><a href="/JVM/JVM-Memory-Structure-Stack.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="java虚拟机栈的内存结构"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-19T13:22:00.000Z">2019-02-19</time></div> <a href="/JVM/JVM-Memory-Structure-Stack.html" class="has-link-black-ter is-size-6">java虚拟机栈的内存结构</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/JVM/">JVM</a></p></div></div></article><article class="media"><a href="/JVM/JVM-Memory-Structure-Menu.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="JVM内存结构-总纲"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-16T05:21:00.000Z">2019-02-16</time></div> <a href="/JVM/JVM-Memory-Structure-Menu.html" class="has-link-black-ter is-size-6">JVM内存结构-总纲</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/JVM/">JVM</a></p></div></div></article><article class="media"><a href="/redis/Redis-Partitioning.html" class="media-left"><p class="image is-64x64"> <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis分片方案概要(Cluster or Codis)"></p></a><div class="media-content"><div class="content"><div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-02-15T07:21:00.000Z">2019-02-15</time></div> <a href="/redis/Redis-Partitioning.html" class="has-link-black-ter is-size-6">Redis分片方案概要(Cluster or Codis)</a><p class="is-size-7 is-uppercase"> <a class="has-link-grey -link" href="/categories/redis/">redis</a></p></div></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label"> 归档</h3><ul class="menu-list"><li> <a class="level is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span> <span class="level-end"><span class="level-item tag">5</span></span></a></li><li> <a class="level is-marginless" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span> <span class="level-end"><span class="level-item tag">1</span></span></a></li><li> <a class="level is-marginless" href="/archives/1970/12/"><span class="level-start"><span class="level-item">十二月 1970</span></span> <span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label"> 标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"> <a class="tags has-addons" href="/tags/BUG/"><span class="tag">BUG</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Consul/"><span class="tag">Consul</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/DATABASE/"><span class="tag">DATABASE</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/JVM内存结构/"><span class="tag">JVM内存结构</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/LOCK/"><span class="tag">LOCK</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/MYSQL/"><span class="tag">MYSQL</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/Spring-Cloud/"><span class="tag">Spring-Cloud</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span> <span class="tag is-grey">3</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/redis集群/"><span class="tag">redis集群</span> <span class="tag is-grey">2</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/事务/"><span class="tag">事务</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/优化/"><span class="tag">优化</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/分布式/"><span class="tag">分布式</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/每天进步一点点/"><span class="tag">每天进步一点点</span> <span class="tag is-grey">1</span></a></div><div class="control"> <a class="tags has-addons" href="/tags/源码分析/"><span class="tag">源码分析</span> <span class="tag is-grey">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div id="power-count"><div class="outer"><div id="footer-info" class="inner"> &copy;2018 - 2020 神奇宝贝大师版权所有<br></div></div><div class="powered-by"><i class="fa fa-mouse-pointer"></i> <span id="busuanzi_container_site_pv">访问量:<span class="foot-count" id="busuanzi_value_site_pv">N^N</span></span><i class="fa fa-user"></i> <span id="busuanzi_container_site_uv">您是第<span class="foot-count" id="busuanzi_value_site_uv">N+1</span>个小伙伴</span></div></div><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"> <a class="footer-logo is-block has-mb-6" href="/"><img src="/images/avatar.png" alt="Spring-Cloud服务在Consul中的多实例注册问题" height="28"></a><p class="is-size-7"> &copy; 2020 神奇宝贝大师&nbsp; Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" title="GitHub" href="https://github.com/HeyFL" rel="external nofollow noopener noreferrer"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://unpkg.com/mermaid@8.0.0/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script><script>function eventDelegate(e,n,t,l){function o(e){var t=e||window.event,o=t.target||t.srcElement,r=t.currentTarget;for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),o=t.length;0<=--o&&t.item(o)!==this;);return-1<o});o!==r;){if(o.matches(n)){var c=o;l.call(c,Array.prototype.slice.call(arguments))}o=o.parentNode}}t.split(".").forEach(function(t){Array.prototype.slice.call(document.querySelectorAll(e)).forEach(function(e){e.addEventListener(t,o)})})}eventDelegate("body",".gitter-open-chat-button","click",function(){$("#live2d-widget").attr("style","display:none")}),eventDelegate("body",".gitter-chat-embed-action-bar-item.gitter-chat-embed-action-bar-item-collapse-chat","click",function(){$("#live2d-widget").attr("style","")})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer="defer"></script><script src="/js/gallery.js" defer="defer"></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" rel="external nofollow noopener noreferrer" target="_blank">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer="defer"></script><script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})})</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer="defer"></script><script src="/js/clipboard.js" defer="defer"></script><script src="/js/main.js" defer="defer"></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"> <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer="defer"></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right",width:80,height:150},mobile:{show:!1}})</script></body></html>